<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Photo Review - MGA Volleyball Tryouts</title>
    <link rel="icon" type="image/png" href="https://mgavolleyball.com/wp-content/uploads/2023/07/mga-logo-277x300.png">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <img src="https://mgavolleyball.com/wp-content/uploads/2023/07/mga-logo-277x300.png" 
                 alt="MGA Volleyball Logo" 
                 class="logo">
        </div>
        
        <div class="header-center">
            <h1 id="page-title">ğŸ“· Photo Review</h1>
        </div>
        
        <div class="header-right">
            <a href="index.html" class="nav-btn secondary">ğŸ“Š Dashboard</a>
            <button class="nav-btn" onclick="openGroupPhotoModal()">ğŸ“¸ Group Photos</button>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </div>
    
    <div class="nav-tabs" id="navigation-tabs">
        <div class="loading">Loading sessions...</div>
    </div>
    
    <div class="controls">
        <div class="stats" id="session-stats">
            Select a session to view players
        </div>
        <div class="sort-controls">
            <a href="#" class="sort-btn" id="sort-name" onclick="sortPlayers('name'); return false;">ğŸ“ Name</a>
            <a href="#" class="sort-btn" id="sort-pinny" onclick="sortPlayers('pinny'); return false;">ğŸ“ Pinny</a>
        </div>
    </div>
    
    <div class="container">
        <div class="photo-grid" id="players-container">
            <div class="loading">Select a session above to view players</div>
        </div>
    </div>

    <!-- Camera Modal -->
    <div id="camera-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCameraModal()">&times;</span>
            <h3 id="camera-modal-title">ğŸ“¸ Capture Photo</h3>
            <div id="camera-container">
                <div id="camera-preview-container" style="position: relative; display: none;">
                    <video id="camera-video" autoplay playsinline style="width: 100%; max-width: 400px; border-radius: 10px;"></video>
                    <div class="camera-overlay">
                        <div class="pose-guide"></div>
                    </div>
                </div>
                <canvas id="camera-canvas" style="display: none;"></canvas>
                <img id="captured-image" style="display: none; max-width: 100%; border-radius: 8px;">
                <div id="camera-placeholder" style="padding: 2rem; text-align: center; color: #666;">
                    ğŸ“·<br><small>Click "Start Camera" to begin</small>
                </div>
            </div>
            <div class="camera-controls">
                <button id="start-camera-btn" class="staff-btn photo-btn">ğŸ“· Start Camera</button>
                <button id="take-photo-btn" class="staff-btn checkin-btn" style="display: none;">ğŸ“¸ Take Photo</button>
                <button id="retake-btn" class="staff-btn photo-btn" style="display: none;">ğŸ”„ Retake</button>
                <button id="submit-photo-btn" class="staff-btn checkin-btn" style="display: none;">âœ… Submit Photo</button>
                <button onclick="closeCameraModal()" class="staff-btn photo-btn">âŒ Cancel</button>
            </div>
            <div id="camera-status" style="margin-top: 1rem; text-align: center; font-weight: 600;"></div>
        </div>
    </div>

    <!-- Group Photo Modal -->
<div id="group-photo-modal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <span class="close" onclick="closeGroupPhotoModal()">&times;</span>
        <h3 id="group-photo-title">ğŸ“¸ Group Photos by Position</h3>
        
        <!-- Step 1: Select Filters -->
        <div id="group-photo-filters" class="group-photo-step">
            <h4>Select Position Group</h4>
            <div class="filter-row">
                <label>Location:</label>
                <select id="group-location">
                    <option value="">Choose Location</option>
                    <option value="NORTH">North</option>
                    <option value="SOUTH">South</option>
                </select>
            </div>
            <div class="filter-row">
                <label>Age Group:</label>
                <select id="group-age">
                    <option value="">Choose Age</option>
                    <option value="13U">13U</option>
                    <option value="14U">14U</option>
                    <option value="15U">15U</option>
                    <option value="16U">16U</option>
                    <option value="17U">17U</option>
                    <option value="18U">18U</option>
                </select>
            </div>
            <div class="filter-row">
                <label>Position:</label>
                <select id="group-position">
                    <option value="">Choose Position</option>
                    <option value="Setter">Setter</option>
                    <option value="Outside Hitter">Outside Hitter</option>
                    <option value="Middle Blocker">Middle Blocker</option>
                    <option value="Right Side">Right Side</option>
                    <option value="Opposite">Opposite</option>
                    <option value="Libero">Libero</option>
                    <option value="Defensive Specialist">Defensive Specialist</option>
                </select>
            </div>
            <button class="staff-btn checkin-btn" onclick="loadPositionPlayers()">ğŸ“‹ Load Players</button>
        </div>

        <!-- Step 2: Player Checklist -->
        <div id="group-photo-checklist" class="group-photo-step" style="display: none;">
            <div class="checklist-header">
                <h4 id="position-title">Position Players</h4>
                <div class="checklist-stats">
                    <span id="players-selected">0</span> of <span id="players-total">0</span> selected
                </div>
            </div>
            <div id="players-checklist" class="players-checklist">
                <!-- Players will be populated here -->
            </div>
            <div class="checklist-actions">
                <button class="staff-btn photo-btn" onclick="selectAllPlayers()">âœ… Select All</button>
                <button class="staff-btn photo-btn" onclick="clearAllPlayers()">âŒ Clear All</button>
                <button class="staff-btn checkin-btn" onclick="startGroupPhoto()">ğŸ“¸ Take Group Photo</button>
            </div>
        </div>

        <!-- Step 3: Camera with Player Detection -->
        <div id="group-photo-camera" class="group-photo-step" style="display: none;">
            <h4>Position Players in Order by Pinny Number</h4>
            <div id="group-camera-container">
                <div id="group-camera-preview" style="position: relative; display: none;">
                    <video id="group-camera-video" autoplay playsinline style="width: 100%; max-width: 600px; border-radius: 10px;"></video>
                    <div class="group-camera-overlay">
                        <div class="group-pose-guide"></div>
                    </div>
                </div>
                <canvas id="group-camera-canvas" style="display: none;"></canvas>
                <img id="group-captured-image" style="display: none; max-width: 100%; border-radius: 8px;">
                <div id="group-camera-placeholder" style="padding: 2rem; text-align: center; color: #666;">
                    ğŸ“·<br><small>Click "Start Camera" to begin</small>
                </div>
            </div>
            
            <!-- Expected Players Display -->
            <div class="expected-players">
                <h5>Expected in this photo:</h5>
                <div id="expected-players-list"></div>
            </div>
            
            <div class="group-camera-controls">
                <button id="start-group-camera-btn" class="staff-btn photo-btn">ğŸ“· Start Camera</button>
                <button id="take-group-photo-btn" class="staff-btn checkin-btn" style="display: none;">ğŸ“¸ Take Photo</button>
                <button id="retake-group-btn" class="staff-btn photo-btn" style="display: none;">ğŸ”„ Retake</button>
                <button id="analyze-group-btn" class="staff-btn checkin-btn" style="display: none;">ğŸ” Detect Players</button>
            </div>
            <div id="group-camera-status" style="margin-top: 1rem; text-align: center; font-weight: 600;"></div>
        </div>

        <!-- Step 4: Confirm Players in Photo -->
        <div id="group-photo-confirm" class="group-photo-step" style="display: none;">
            <h4>Confirm Players in Photo</h4>
            <div class="detected-vs-expected">
                <div class="detected-numbers">
                    <h5>Detected Pinny Numbers:</h5>
                    <div id="detected-numbers-list"></div>
                </div>
                <div class="confirm-checklist">
                    <h5>Confirm players in photo:</h5>
                    <div id="confirm-players-list"></div>
                </div>
            </div>
            <div class="confirm-actions">
                <button class="staff-btn photo-btn" onclick="goBackToCamera()">ğŸ“· Retake Photo</button>
                <button class="staff-btn checkin-btn" onclick="saveGroupPhoto()">ğŸ’¾ Save Photo</button>
            </div>
        </div>

        <!-- Step 5: Results & Next Photo -->
        <div id="group-photo-results" class="group-photo-step" style="display: none;">
            <h4>Photo Saved Successfully!</h4>
            <div class="results-summary">
                <div id="results-message"></div>
                <div id="remaining-players"></div>
            </div>
            <div class="results-actions">
                <button class="staff-btn checkin-btn" onclick="takeAnotherGroupPhoto()" style="display: none;">ğŸ“¸ Take Another Photo</button>
                <button class="staff-btn photo-btn" onclick="finishGroupPhotos()">âœ… Finish</button>
                <button class="staff-btn photo-btn" onclick="startNewPosition()">ğŸ”„ New Position</button>
            </div>
        </div>
    </div>
</div>
    
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/players.js"></script>
</body>
</html>
